name: main

on:
    # æ¯å½“ push åˆ° main åˆ†æ”¯æ—¶è§¦å‘éƒ¨ç½²
    push:
        tags:
            - "v*.*.*"
    # æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
    workflow_dispatch:

jobs:
    docs:
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ¡æ‹‰å–ä»£ç 
              uses: actions/checkout@v3
              with:
                  # â€œæœ€è¿‘æ›´æ–°æ—¶é—´â€ ç­‰ git æ—¥å¿—ç›¸å…³ä¿¡æ¯ï¼Œéœ€è¦æ‹‰å–å…¨éƒ¨æäº¤è®°å½•
                  fetch-depth: 0

            - name: ğŸ’¾ç¼“å­˜ Composer ä¾èµ–
              uses: actions/cache@v3
              with:
                  path: /tmp/composer-cache
                  key: ${{ runner.os }}-${{ hashFiles('**/composer.lock') }}

            - name: âœï¸æå–æ ‡ç­¾åç§°
              run: echo "${{ github.ref }}" | cut -d '/' -f 3
              id: tag_name

            - name: ğŸ’¾ä¿å­˜ç¯å¢ƒå˜é‡
              run: echo "TAG_NAME=${{ steps.tag_name.outputs.stdout }}" >> $GITHUB_ENV

            - name: ğŸ› ï¸å®‰è£…ä¾èµ–
              uses: php-actions/composer@v6
              with:
                  php_version: "8.1"
                  version: 2

            - name: âŒåˆ é™¤éå¿…è¦æ–‡ä»¶
              run: |
                  rm -rf .gitignore .github .git DOCKER_ENV docker_tag composer.json composer.lock script lock.txt upload.md test.env think

            - name: ğŸ“¦å‹ç¼©ä¸ºzip
              run: zip -r LoveCards-${{ env.TAG_NAME }}.zip ./
              env:
                  TAG_NAME: ${{ env.TAG_NAME }}

            - name: ğŸ…åˆ›å»ºå‘å¸ƒå¹¶ä¸Šä¼ å‹ç¼©åŒ…
              uses: softprops/action-gh-release@v1
              if: startsWith(github.ref, 'refs/tags/')
              with:
                  tag_name: ${{ env.TAG_NAME }}
                  name: 2.2.0[1.0.15] # è®°å¾—ä¿®æ”¹
                  body_path: .github/RELEASE.txt
                  draft: false
                  prerelease: false
                  files: |
                      LoveCards-${{ env.TAG_NAME }}.zip
                      LICENSE
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
