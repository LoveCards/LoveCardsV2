name: 3.ğŸŒŸå‘å¸ƒ æ­£å¼ç‰ˆ

on:
    # æ¯å½“ push åˆ° main åˆ†æ”¯æ—¶è§¦å‘éƒ¨ç½²
    push:
        tags:
            - "v[0-9]*.[0-9]*.[0-9]*"
    # æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
    workflow_dispatch:

jobs:
    # è°ƒç”¨ä¸Šæ¸¸ reusable workflow
    release-buildDocker:
        uses: LoveCards/LoveCardsV2/.github/workflows/release-buildDocker.yml@dev

    Build_Release:
        name: ğŸŒŸ å‘å¸ƒæ­£å¼ç‰ˆ
        needs: release-buildDocker # ç­‰ä¸Šæ¸¸è·‘å®Œ
        runs-on: ubuntu-latest
        env:
            commit_sha: ${{ github.sha }}
            release_buildDocker_file_name: lovecards-web-frankenphp
            release_buildWeb_file_name: LoveCardsV2

        steps:
            - name: ğŸ¡ æ‹‰å–ä»£ç 
              uses: actions/checkout@v4
              with:
                  fetch-depth: 1

            - name: ğŸ“¥ è·å–é¡¹ç›®å‹ç¼©åŒ…
              uses: actions/download-artifact@v4
              with:
                  name: ${{env.release_buildWeb_file_name}}
                  path: ./tmp/

            - name: ğŸ“¥ è·å–Docker(frankenphp)é•œåƒ
              uses: actions/download-artifact@v4
              with:
                  name: ${{env.release_buildDocker_file_name}}
                  path: ./tmp/

            - name: ğŸ… åˆ›å»ºå‘å¸ƒå¹¶ä¸Šä¼ å‹ç¼©åŒ…
              uses: softprops/action-gh-release@v1
              if: startsWith(github.ref, 'refs/tags/')
              with:
                  tag_name: ${{ github.ref_name }} # åˆ›å»ºTag
                  name: ${{ github.ref_name }} # å‘å¸ƒåç§°
                  body_path: RELEASE.txt # å‘å¸ƒè¯´æ˜
                  draft: false # æ˜¯å¦ä¸ºè‰ç¨¿
                  prerelease: true # æ˜¯å¦ä¸ºé¢„å‘å¸ƒ
                  files: |
                      ./tmp/${{env.release_buildDocker_file_name}}.zip
                      ./tmp/${{env.release_buildWeb_file_name}}.zip
                      LICENSE
              env:
                  # @see https://docs.github.com/cn/actions/reference/authentication-in-a-workflow#about-the-github_token-secret
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
