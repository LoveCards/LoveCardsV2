name: 1.ğŸ˜æ„å»º é¡¹ç›®ä¸»ä½“

on:
    # æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
    workflow_dispatch:
    # å…è®¸è¢«å…¶ä»–ä»“åº“è°ƒç”¨
    workflow_call:

jobs:
    # è°ƒç”¨ä¸Šæ¸¸ reusable workflow
    Build_AdminFrontEnd:
        uses: LoveCards/v2_frontend_admin/.github/workflows/build-call.yml@main

    release-buildWeb:
        name: ğŸ“¦æ‰“åŒ… é¡¹ç›® ä¸»ä½“
        needs: Build_AdminFrontEnd # ç­‰ä¸Šæ¸¸è·‘å®Œ
        runs-on: ubuntu-latest
        env:
            commit_sha: ${{ github.sha }}
            file_name: LoveCardsV2
            Build_AdminFrontEnd_file_name: admin

        steps:
            - name: ğŸ¡æ‹‰å–ä»£ç 
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: ğŸ’¾ç¼“å­˜ Composer ä¾èµ–
              uses: actions/cache@v4
              with:
                  path: /tmp/composer-cache
                  key: ${{ runner.os }}-${{ hashFiles('**/composer.lock') }}

            - name: ğŸ› ï¸å®‰è£…ä¾èµ–
              uses: php-actions/composer@v6
              with:
                  php_version: "8.1"
                  version: 2

            - name: ğŸ“¥è·å–å‰ç«¯å‹ç¼©åŒ…
              uses: actions/download-artifact@v4
              with:
                  name: ${{env.Build_AdminFrontEnd_file_name}} # ä¸ä¸Šæ¸¸ upload-artifact çš„ name ä¸€è‡´
                  path: ./tmp

            - name: ğŸ”“è§£å‹å‰ç«¯è‡³Publicç›®å½•
              run: |
                  mkdir -p public
                  unzip -q ./tmp/${{env.Build_AdminFrontEnd_file_name}}.zip -d ./tmp
                  mv ./tmp/${{env.Build_AdminFrontEnd_file_name}} ./public/
                  rm -rf ./tmp

            - name: âŒåˆ é™¤éå¿…è¦æ–‡ä»¶
              run: |
                  rm -rf .gitignore .github .dev ToDo.md .git DOCKER_ENV docker_tag output.log composer.json composer.lock script lock.txt upload.md test.env .frankenphp .docker

            - name: ğŸ“¦å‹ç¼©ä¸ºzip
              run: zip -r ${{env.file_name}}.zip ./

            - name: ğŸš€ä¸Šä¼ Artifact
              uses: actions/upload-artifact@v4
              with:
                  name: ${{env.file_name}}
                  path: ${{env.file_name}}.zip
                  if-no-files-found: error
