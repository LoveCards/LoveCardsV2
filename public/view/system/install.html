<!DOCTYPE html>
<html lang="en">

<head>
    <title>å®‰è£…ç¨‹åº</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <link rel="shortcut icon" href="{__A-assets__}/img/favicon.ico">
    <link rel="stylesheet" href="{__A-assets__}/mdui-v1.0.2/css/mdui.min.css" />
    <link rel="stylesheet" href="{__A-assets__}/base.css" />

    <style>
        .mask-xs {
            max-height: 180px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mask-md {
            max-height: 640px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hide {
            display: none;
        }

        .mdui-card-primary-subtitle a {
            color: #ff4081;
            position: relative;
            display: inline-block;
            overflow: hidden;
            text-decoration: none;
            vertical-align: top;
            outline: 0;
        }

        .tab-e {
            height: 400px;
        }
    </style>
</head>

<body class="mdui-theme-primary-indigo mdui-theme-layout-light mdui-theme-accent-pink">
    <div class="mdui-container-fluid">
        <div class="mdui-card" style="margin: 5%;">
            <div class="mdui-row">
                <div class="mdui-col-xs-12 mdui-col-md-5 mask-md mdui-hidden-sm-down">
                    <img style="height: 680px;" src="https://img1.imgtp.com/2023/05/05/rsGxwTe7.gif">
                    <div class="mdui-card-media-covered mdui-p-x-2  ">
                        <div class="mdui-card-primary">
                            <div class="mdui-card-primary-title">LoveCards</div>
                            <div class="mdui-card-primary-subtitle">
                                Crafted with <a href="{$systemVer.Url}">{$systemVer.Name}</a> Â© 2023 time Made by åƒçº¸æ€ª.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mdui-col-xs-12 mdui-col-md-6 mask-xs mdui-hidden-md-up">
                    <img src="https://img1.imgtp.com/2023/05/05/rsGxwTe7.gif" style="width: 100%;">
                    <div class="mdui-card-media-covered mdui-p-x-2  ">
                        <div class="mdui-card-primary">
                            <div class="mdui-card-primary-title">LoveCards</div>
                            <div class="mdui-card-primary-subtitle">
                                Crafted with <a href="{$systemVer.Url}">{$systemVer.Name}</a> Â© 2023 time Made by åƒçº¸æ€ª.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mdui-col-xs-12 mdui-col-md-7">
                    <div class="mdui-p-x-5 mdui-p-t-4">
                        <div id="tab" class="mdui-tab mdui-tab-full-width">
                            <a id="tab1" class="mdui-ripple">ç‰ˆæœ¬è¯¦æƒ…</a>
                            <a id="tab2" class="mdui-ripple" disabled>ç¯å¢ƒæ£€æµ‹</a>
                            <a id="tab3" class="mdui-ripple" disabled>é…ç½®æ•°æ®åº“</a>
                            <a id="tab4" class="mdui-ripple" disabled>å®Œæˆå®‰è£…</a>
                        </div>
                    </div>

                    <div class="mdui-p-x-5 mdui-p-t-5">
                        <div id="tab-e1">
                            <div class="mdui-typo tab-e">
                                <h4 style="margin-top: 0;font-weight:500;">LoveCards</h4>
                                <ul>
                                    <li>ğŸ—ƒï¸å½“å‰ç‰ˆæœ¬ï¼š<kbd>{$systemVer.VerS}[{$systemVer.Ver}]</kbd></li>
                                    <li>ğŸ†•æœ€æ–°ç‰ˆæœ¬ï¼š<a href="https://github.com/zhiguai/LoveCards/releases"><kbd
                                                id="NewVerS">åŠ è½½ä¸­...</kbd></a>
                                                <pre style="max-height:150px" id="NewVerSVerLog">åŠ è½½ä¸­...</pre>
                                    </li>
                                </ul>
                                <ul>
                                    <li>ğŸ’»é¡¹ç›®ä¸»é¡µï¼š<a href="https://lovecards.cn/" target="_blank">lovecards.cn</a></li>
                                    <li>ğŸ‘¨â€ğŸ’»Githubä¸»é¡µï¼š<a href="https://github.com/zhiguai/LoveCards"
                                            target="_blank">github.com/zhiguai/LoveCards</a></li>
                                    <li>ğŸ‘©â€ğŸ‘§â€ğŸ‘¦äº¤æµç¤¾åŒºï¼š<a href="https://forum.lovecards.cn/"
                                            target="_blank">forum.lovecards.cn</a></li>
                                    <li>ğŸ‘¯â€â™‚QQäº¤æµç¾¤ï¼š<a href="{$systemVer.QGroupUrl}" target="_blank">801235342</a></li>
                                </ul>

                            </div>
                        </div>
                        <div id="tab-e2" class="hide">
                            <div class="mdui-typo tab-e">
                                <div class="mdui-row mdui-p-b-1">
                                    <div class="mdui-col-xs-6">
                                        <h4 style="margin-top: 0;font-weight:500;">ç¯å¢ƒæ£€æµ‹</h4>
                                    </div>
                                    <div class="mdui-col-xs-6">
                                        <button id="btnVerifyEnvironment"
                                            class="mdui-float-right mdui-btn mdui-color-theme-accent mdui-ripple mdui-btn-dense">é‡æ–°æ£€æµ‹</button>
                                    </div>
                                </div>
                                <div class="mdui-table-fluid">
                                    <table class="mdui-table">
                                        <thead>
                                            <tr>
                                                <th>æ£€æµ‹é¡¹ç›®</th>
                                                <th>æœ¬åœ°ç‰ˆæœ¬</th>
                                                <th>è¦æ±‚ç‰ˆæœ¬</th>
                                                <th>çŠ¶æ€</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>PHP</td>
                                                <td id="verifyEnvironmentPhpV">{$verifyEnvironment.php.v}</td>
                                                <td>[{$systemVer.InstallEnvironment.php.f},{$systemVer.InstallEnvironment.php.l})
                                                </td>
                                                <td id="verifyEnvironmentPhpS">{$verifyEnvironment.php.s ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>MySQL</td>
                                                <td>è‡ªæŸ¥</td>
                                                <td>[{$systemVer.InstallEnvironment.mysql.f},{$systemVer.InstallEnvironment.mysql.l})
                                                </td>
                                                <td>è‡ªæŸ¥</td>
                                            </tr>
                                            <tr>
                                                <td>PDOæ‰©å±•</td>
                                                <td></td>
                                                <td></td>
                                                <td id="verifyEnvironmentPdo_mysql">{$verifyEnvironment.pdo_mysql ? 'å¯ç”¨'
                                                    : 'ä¸å¯ç”¨'}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                        <div id="tab-e3" class="hide">
                            <div class="tab-e">
                                <div class="mdui-textfield">
                                    <label class="mdui-textfield-label">æ•°æ®åº“æœåŠ¡å™¨</label>
                                    <textarea id="formDataHostname" class="mdui-textfield-input">localhost</textarea>
                                </div>
                                <div class="mdui-textfield">
                                    <label class="mdui-textfield-label">æ•°æ®åº“ç”¨æˆ·å</label>
                                    <textarea id="formDataUsername" class="mdui-textfield-input"></textarea>
                                </div>
                                <div class="mdui-textfield">
                                    <label class="mdui-textfield-label">æ•°æ®åº“å¯†ç </label>
                                    <textarea id="formDataPassword" class="mdui-textfield-input"></textarea>
                                </div>
                                <div class="mdui-textfield">
                                    <label class="mdui-textfield-label">æ•°æ®åº“ç«¯å£</label>
                                    <textarea id="formDataHostport" class="mdui-textfield-input">3306</textarea>
                                </div>
                                <div class="mdui-textfield">
                                    <label class="mdui-textfield-label">æ•°æ®åº“å</label>
                                    <textarea id="formDataDatabase" class="mdui-textfield-input"></textarea>
                                </div>
                            </div>
                        </div>

                        <div id="tab-e4" class="hide">
                            <div class="mdui-typo tab-e">
                                <h4 class="mdui-text-center" style="margin-top: 0;">å®‰è£…å®Œæˆ</h4>
                                <p>
                                <ul>
                                    <li>âš™ï¸ç®¡ç†åœ°å€ï¼š/admin</li>
                                    <li>ğŸšªé—¨æˆ·é¦–é¡µï¼š/index</li>
                                    <li>ğŸ’»é»˜è®¤è´¦æˆ·ï¼šadmin admin</li>
                                </ul>
                                </p>
                                <!-- <blockquote>å¦‚æœæ‚¨å®‰è£…å¹¶ä½¿ç”¨äº†è¯¥ç¨‹åºï¼Œå°†é»˜è®¤æ‚¨é˜…è¯»å¹¶åŒæ„è¯¥æ¡æ¬¾<a
                                        href="http://fatda.cn/index.php/archives/8/">ã€ŠFatdaç”¨æˆ·æ¡æ¬¾ã€‹</a></blockquote> -->
                            </div>
                        </div>
                    </div>

                    <div class="mdui-p-x-5 mdui-p-t-5 mdui-p-b-4">
                        <button id="btnPrev" class="mdui-btn mdui-ripple mdui-color-theme-accent"
                            style="visibility: hidden;">ä¸Šä¸€æ­¥</button>
                        <button id="btnNext"
                            class="mdui-btn mdui-ripple mdui-color-theme-accent mdui-float-right">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{__A-assets__}/jquery-3.6.0/jquery.min.js"></script>
    <script src="{__A-assets__}/mdui-v1.0.2/js/mdui.min.js"></script>
    <script src="{__A-assets__}/jquery_lazyload-1.9.7/jquery.lazyload.js"></script>
    <script src="{__A-assets__}/jquery-cookie-1.4.1/jquery.cookie.min.js"></script>
    <script src="{__A-assets__}/base.js"></script>
    <script src="{__A-assets__}/public.js"></script>
    <script>
        //Base
        var currentDate = new Date();
        var currentYear = currentDate.getFullYear();
        //ä¸»é¡µä¿¡æ¯
        const BaseFun = () => {
            //æœ€æ–°ç‰ˆæœ¬
            var result = apiAjax0a('', 'https://api.github.com/repos/zhiguai/LoveCards/releases/latest', 'get', false);
            if (result['r'] != []) {
                var data = result['r'];
                $('#NewVerS').text(data['name']);
            } else {
                $('#NewVerS').text('å‰å¾€æŸ¥çœ‹');
            }
            $.ajax({ url: "https://ghps.cc/https://raw.githubusercontent.com/zhiguai/LoveCards/main/VerLog.md", type: 'GET', async: true }).then(function (data) {
                $('#NewVerSVerLog').text(data);
            }).catch(function (error) {
                $('#NewVerSVerLog').text('è·å–å¤±è´¥');
            });
        }; BaseFun();
        //æ›´æ–°ç‰ˆæƒ
        $('.mdui-card-primary-subtitle').html('Crafted with <a href="{$systemVer.Url}">{$systemVer.Name}</a> Â© ' + currentYear + ' Made by åƒçº¸æ€ª.')

        //åˆå§‹åŒ–
        var nowTab = 1;
        var inst = new mdui.Tab('#tab');
        //é¡µé¢åŠ¨æ€
        var FunTabControl = (state) => {
            nowTab = nowTab + state;
            //æ˜¾ç¤ºä¸‹ä¸€ä¸ªTab
            $('#tab' + nowTab).attr("disabled", false);
            $('#tab-e' + nowTab).attr('class', '');
            //éšè—å½“å‰Tab
            $('#tab' + (nowTab - state)).attr("disabled", true);
            $('#tab-e' + (nowTab - state)).attr('class', 'hide');
        }
        //ä¸‹ä¸€é¡µ
        var btnNext = () => {
            if (nowTab < $('#tab').children().length - 1) {
                //æ˜¾ç¤ºä¸Šä¸€é¡µbtn
                $('#btnPrev').attr('style', '');
                //é”å®šå…¶ä»–Tab
                FunTabControl(1);
                //æ›´æ–°è¿›åº¦æ¡
                inst.next();
                if (nowTab == $('#tab').children().length - 1) {
                    //éšè—ä¸Šä¸€é¡µbtn
                    $('#btnPrev').remove();
                    $('#btnNext').attr('class', 'mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent mdui-btn-block').text('è¿›å…¥ä½ çš„é¢†åŸŸï¼');
                }
            } else {
                //console.log('å®‰è£…å®Œæˆ');
            }
        }
        //ä¸Šä¸€é¡µ
        var btnPrev = () => {
            if (nowTab > 1) {
                //é”å®šå…¶ä»–Tab
                FunTabControl(-1);
                //æ›´æ–°è¿›åº¦æ¡
                inst.prev();
                if (nowTab == 1) {
                    //éšè—ä¸Šä¸€é¡µbtn
                    $('#btnPrev').attr('style', 'visibility: hidden;');
                }
            } else {
                //console.log('ç¬¬ä¸€é¡µäº†');
            }
        }

        //é‡æ–°æ£€æµ‹ç¯å¢ƒ
        $('#btnVerifyEnvironment').click(function () {
            var result = apiAjax0('', apiSystemInstallVerifyEnvironment, 'POST', false);
            if (result['ec'] == 200) {
                mdui.snackbar({
                    message: 'ç»“æœå·²æ›´æ–°',
                    position: 'left-top'
                });
                VEStatus = String(result['data']['pdo_mysql'] && result['data']['php']['s']);
                $('#verifyEnvironmentPhpV').text(result['data']['php']['v']);
                $('#verifyEnvironmentPhpS').text(result['data']['php']['s'] ? 'å¯ç”¨' : 'ä¸å¯ç”¨');
                $('#verifyEnvironmentPdo_mysql').text(result['data']['pdo_mysql'] ? 'å¯ç”¨' : 'ä¸å¯ç”¨');
            }
        })
        var VEStatus = '{$verifyEnvironment.php.s && $verifyEnvironment.pdo_mysql ? "true" : "fasle"}';

        //æ“ä½œ
        $('#btnNext').click(function () {
            //æ•°æ®åº“tab
            if (nowTab == 2) {
                if (VEStatus != 'true') {
                    //å¤±è´¥
                    mdui.snackbar({
                        message: 'ç¯å¢ƒä¸å¯ç”¨è¯·é‡æ–°æ£€æµ‹åå†ç»§ç»­',
                        position: 'left-top'
                    });
                } else {
                    btnNext();
                }
            } else if (nowTab == 3) {
                //æ•°æ®åº“å¯¼å…¥
                var data = {
                    'hostname': $('#formDataHostname').val(),
                    'database': $('#formDataDatabase').val(),
                    'username': $('#formDataUsername').val(),
                    'password': $('#formDataPassword').val(),
                    'hostport': $('#formDataHostport').val(),
                };
                var result = apiAjax0a(data, apiSystemInstallSetDbConfig, 'POST', false);
                //console.log(result['r']);
                if (result['r']['ec'] == 200) {
                    //æˆåŠŸ
                    mdui.snackbar({
                        message: 'æ•°æ®åº“é…ç½®æˆåŠŸ',
                        position: 'left-top'
                    });
                    btnNext();
                } else if (result['r']['ec'] == 201) {
                    //é€‰æ‹©è·³è¿‡
                    mdui.snackbar({
                        position: 'left-top',
                        message: 'msg&nbsp;:&nbsp;' + result['r']['msg'],
                        buttonText: 'è·³è¿‡',
                        onButtonClick: function () {
                            btnNext();
                        }
                    });
                } else {
                    //æŠ¥é”™
                    mdui.snackbar({
                        position: 'left-top',
                        message: 'msg&nbsp;:&nbsp;' + result['r']['msg'] + '<br>code&nbsp;:&nbsp;' + result['r']['ec'],
                    });
                }
            } else if (nowTab == 4) {
                var result = apiAjax0a([], apiSystemInstallSetInstallLock, 'POST', false);
                if (result['r']['ec'] == 200) {
                    //æˆåŠŸ
                    mdui.snackbar({
                        message: 'å®‰è£…è®°å½•ç”ŸæˆæˆåŠŸ',
                        position: 'left-top'
                    });
                    jumpUrl('/', 0);
                } else {
                    //æŠ¥é”™
                    mdui.snackbar({
                        position: 'left-top',
                        message: 'msg&nbsp;:&nbsp;' + result['r']['msg'] + '<br>code&nbsp;:&nbsp;' + result['r']['ec'],
                    });
                }
            } else {
                //æ­£å¸¸ä¸‹ä¸€æ­¥
                btnNext();
            }
        })
        $('#btnPrev').click(function () {
            btnPrev();
        })
    </script>

</body>